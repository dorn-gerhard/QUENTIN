%test GC:

points = linspace(-6,6,10000);
i0p = 10^-8;
E_p = 1;
E_n = -2;
E_q = 1;
C1 = complex(2+7i);
C2 = complex(3+i);
C3 = complex(-2.1 + 2.1i);
C4 = complex(1-3.2i);
rho = complex(1+2i);


[G, GK] = GF(points, i0p, E_p, E_n, E_q, C1, C2, C3, C4, rho);
sum(abs(G))

subplot(2,1,1)
plot(real(G))
subplot(2,1,2)
plot(imag(G))


points = linspace(-6,6,10000);
i0p = 10^-8;
E_p = 1;
E_n = -2;
E_q = 1;
C1 = complex(2+7i);
C2 = complex(3+i);
C3 = complex(-2.1 + 2.1i);
C4 = complex(1-3.2i);
rho = complex(1+2i);



points = linspace(-6,6,24001);
points = points(22255);

i0p = 10^-8;
E_p = [-2.4921   -2.4921   -1.4393   -1.2073   -0.6180    0.3389    0.4074    0.6624    0.6624    1.4871    1.4871    1.6180    2.7140    3.0810    3.0810    3.7172    3.7172    3.8411    4.1004    5.0000    5.4933    5.7515    6.5444    6.5444]';
E_n = -3.5090;
E_q = [-2 0 0 2]';
C1 = complex([ -0.4012   -0.5458   -0.0000    0.0000    0.3900   -0.0000   -0.0833   -0.0057   -0.0898   -0.0056   -0.0040    0.3107   -0.0000   -0.0201   -0.1502   -0.0064   -0.0176   -0.0486 -0.0000   -0.0180   -0.0000   -0.0331   -0.0118    0.0146]);
C2 = complex([-0.4012   -0.5458   -0.0000    0.0000    0.3900   -0.0000   -0.0833   -0.0057   -0.0898   -0.0056   -0.0040    0.3107   -0.0000   -0.0201   -0.1502   -0.0064   -0.0176   -0.0486 -0.0000   -0.0180   -0.0000   -0.0331   -0.0118    0.0146]');
C3 = complex([0.4895   -0.0685    0.0685   -0.0320]);
C4 = complex([ 0.4895;   -0.0685;    0.0685;   -0.0320]);
rho = complex(1);

[G, GK] = GF(points, i0p, E_p, E_n, E_q, C1, C2, C3, C4, rho);
sum(abs(G))


plot_GF(GK, points)
%%
points = linspace(-6,6,24001);
i0p = 10^-4; % i0p = 0.005;


E_p = [0.6, 1.4];
E_n = [-0.4434; 0; 1; 1.4434];
E_m = E_n;
E_q = [-0.4; 0.4];

C1 = complex([-0.679705506819881 0.194936974426936;0.500000000000000 -0.500000000000000;-0.500000000000000 -0.500000000000000;0.194936974426936 0.679705506819881]);
C2 = complex([-0.679705506819881 0.500000000000000 -0.500000000000000 0.194936974426936;0.194936974426936 -0.500000000000000 -0.500000000000000 0.679705506819881]);
C3 = complex([-0.679705506819882 -0.194936974426936;-0.500000000000000 -0.500000000000000;0.500000000000000 -0.500000000000000;0.194936974426936 -0.679705506819881]);
C4 = complex([-0.679705506819882 -0.500000000000000 0.500000000000000 0.194936974426936;-0.194936974426936 -0.500000000000000 -0.500000000000000 -0.679705506819881]);
rho = complex([0.543426376109307 0 0 0;0 7.65303389433442e-05 0 0;0 0 0 0;0 0 0 0]);

[G, GK] = GF(points, i0p, E_p, E_n, E_q, C1, C2, C3, C4, rho);

plot_GF(GK, points)



%% compare 

G2 = zeros(size(points));
GK2 = zeros(size(points));

[E_pp, E_mm] = meshgrid(E_p, E_n);
[E_nn, E_qq] = meshgrid(E_n, E_q);

for k = 1:numel(points)
    G2(k) = G2(k) + rho * (1./(points(k) - (E_pp - E_mm) + i0p*1i) .*C1) * C2 + rho* C3 * (C4 .* 1./(points(k) - (E_nn - E_qq) + i0p*1i));
    GK2(k) = GK2(k) -1i*2*i0p * rho * (1./((points(k) - (E_pp - E_mm)).^2 + i0p^2) .* C1) * C2 + i*2*i0p * rho * C3 * (C4.*1./((points(k) - (E_nn - E_qq)).^2 + i0p^2));
end

plot_GF(G2, points)

plot_GF(GK2, points)




